// Generated by CoffeeScript 1.4.0
(function(){var e,t;t=!1;e=function(){function e(){this.canvas=$("canvas")[0];this.ctx=this.canvas.getContext("2d");this.keys=new Keys;this.world=new World("2d");this.camera=new Camera(this.canvas);this.player=null}e.prototype.update=function(){var e=this;this.render();return window.requestAnimFrame(function(){return e.update()})};e.prototype.initialize=function(){var e,n,r,i=this;this.player=new Body;this.player.type="dynamic";this.player.userData="player";this.player.position={x:0,y:0};this.player.dimensions={w:20,h:30};this.player.shootLock=!1;this.player.shoot=function(){var e;if(i.player.shootLock)return;i.player.shootLock=!0;e=new Body;e.type="dynamic";e.userData="bullet";e.position={x:i.player.position.x+(i.player.dimensions.w/2+10)*Math.cos(i.player.angle),y:i.player.position.y+(i.player.dimensions.h/2+10)*Math.sin(i.player.angle)};e.dimensions={w:5,h:5};e.onCollision=function(e){if(e.userData==="asteroid")return this.alive=!1};e.angle=i.player.angle;e.forces.y=5;return i.world.createBody(e)};this.world.createBody(this.player);t=new Body;t.type="dynamic";t.userData="asteroid";t.position={x:0,y:-150};t.dimensions={w:100,h:100};t.angle=-90*d2r;for(n=r=0;r<=0;n=++r){e=new Fixture;e.dimensions={w:Math.random()*t.dimensions.w,h:Math.random()*t.dimensions.h};e.position={x:-50,y:50};t.createFixture(e);console.log("Asd:",t.angle/d2r);console.log("Fxt:",e.position.x,e.position.y)}t.onCollision=function(e){var n,r,i,s,o;if(e.userData!=="bullet")return;s=t.fixtures;o=[];for(r=0,i=s.length;r<i;r++){n=s[r];o.push(n.detach())}return o};this.world.createBody(t);return this.update()};e.prototype.render=function(){var e,t,n,r,i,s,o,u,a,f,l,c;t=this.canvas;n=this.ctx;this.keys.up&&this.player.forces.y<4&&(this.player.forces.y+=.1);this.keys.down&&this.player.forces.y>0&&(this.player.forces.y-=.1);this.keys.left&&(this.player.forces.s-=.1);this.keys.right&&(this.player.forces.s+=.1);this.keys.space?this.player.shoot():this.player.shootLock=!1;this.player.shoot();this.world.step();if(t.width!==window.innerWidth||t.height!==window.innerHeight){t.width=2*Math.round(window.innerWidth/2);t.height=2*Math.round(window.innerHeight/2)}n.save();n.clearRect(0,0,t.width,t.height);n.translate(t.width/2,t.height/2);n.fillStyle="red";n.beginPath();n.arc(0,0,2,0,Math.PI*2,!1);n.closePath();n.fill();l=this.world.bodies;for(o=0,a=l.length;o<a;o++){e=l[o];if(!e.alive)continue;s=e.position;r=e.dimensions;n.save();n.translate(s.x,s.y);n.rotate(e.angle);n.fillStyle="rgba(0, 100, 0, 0.5)";n.strokeStyle="rgba(0, 150, 0, 1)";n.fillRect(-r.w/2,0-r.h/2,r.w,r.h);n.strokeRect(-r.w/2,0-r.h/2,r.w,r.h);c=e.fixtures;for(u=0,f=c.length;u<f;u++){i=c[u];n.save();s=i.position;r=i.dimensions;n.rotate(i.angle);n.fillRect(s.x-r.w/2,s.y-r.h/2,r.w,r.h);n.strokeRect(s.x-r.w/2,s.y-r.h/2,r.w,r.h);n.restore()}n.restore()}return this.ctx.restore()};return e}();$(document).ready(function(){var t;t=new e;t.assets=new Assets([]);return t.assets.load(function(){return t.initialize()})})}).call(this);